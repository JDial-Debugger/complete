{"version":3,"sources":["webpack:///webpack/bootstrap b797461e34eae2a38fd2","webpack:///./src/scripts/client/app-view.js","webpack:///./src/scripts/client/control-surface.js","webpack:///./src/scripts/client/event-handler.js","webpack:///./src/scripts/client/editor-view.js","webpack:///./src/scripts/client/network.js","webpack:///./src/scripts/client/notification-view.js","webpack:///./src/scripts/client/util.js","webpack:///./src/scripts/client/runtime-view.js","webpack:///./src/scripts/client/storage.js","webpack:///./src/scripts/client/trace-payload.js"],"names":["AppView","edv","jQuery","rtv","mcs","requestPending","requestCancelled","_init","traceAction","disableCommands","startSpinning","enableCommands","showPendingMessage","flush","payload","getProgram","getTrace","err","trace","stopSpinning","send","open","notif","large","code","details","actions","name","command","on","Error","render","haltAction","clear","unfreeze","resetAction","get","dropdownValue","console","error","setWorkingCopyFromBuiltin","value","log","setProgram","dropdownAction","line","freeze","highlightLine","workingCopyExists","exists","getWorkingCopy","matchingBuiltin","workingCopyMatchesBuiltin","set","window","onbeforeunload","setWorkingCopy","app","SPINNER_ON_CLASS","SPINNING_CLASS","ControlSurface","wrapperElem","hasClass","buttonElems","find","commands","toArray","reduce","hash","buttonElem","attr","length","spinner","spinnerOff","dropdown","listener","apply","val","Object","keys","includes","addClass","removeClass","Array","isArray","forEach","EventHandler","events","hasOwnProperty","push","index","indexOf","splice","HL_LINE_CLASS","EditorView","initialProgram","editor","CodeMirror","mode","theme","lineNumbers","indentUnit","smartIndent","tabSize","indentWithTabs","electricChars","highlightedLine","frozen","getValue","newValue","clearHistory","setValue","setOption","clearHighlightedLine","focus","lineNum","PADDING","addLineClass","scrollIntoView","ch","removeLineClass","Network","cb","ajaxDone","res","ajaxFail","superagent","post","stringify","end","ok","parsedTrace","JSON","parse","text","NOTIF_TYPES","Notification","parentElem","type","title","opts","parent","hasCode","replace","hasDetails","action","concat","expired","html","elem","trigger","close","event","btn","currentTarget","append","setTimeout","remove","NOTIF_VIEW_SELECTOR","pendingNotifications","NotificationView","getElem","TAG_REPLACEMENTS","sanitize","dirty","tag","htmlBuilder","elements","out","VALID_TAGS","VALID_FIELDS","tagInfo","tagName","selfClosing","first","second","join","attrs","attrName","test","children","map","child","toString","RuntimeView","cs","rendered","setVisiblePoint","visualizationElem","variablesElem","scope","returnValueStack","reduceRight","point","pointHtml","args","argsHtml","argName","span","funcName","returnValue","pop","input","id","classes","label","for","isReturn","li","parseInt","isNaN","initializeVariableView","radioButton","prop","setVisibleScope","variableListHtml","suggestBtnHtml","cancelBtnHtml","callstack","topCallstack","locals","variablesHtml","localName","placeholder","WORKING_PROGRAM_KEY","BUILTIN_PROGRAMS","Storage","localforage","getItem","then","catch","setItem","builtinID","force","confirm","testProgram","i","len","key","TracePayload","source","stdin"],"mappings":"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","file":"client.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b797461e34eae2a38fd2","import ControlSurface from './control-surface'\nimport EditorView from './editor-view'\nimport Network from './network'\nimport NotificationView from './notification-view'\nimport RuntimeView from './runtime-view'\nimport Storage from './storage'\nimport TracePayload from './trace-payload'\n\nclass AppView {\n  constructor () {\n    this.edv = new EditorView(jQuery('.mp-editor'), '')\n    this.rtv = new RuntimeView(jQuery('.mp-runtime'))\n    this.mcs = new ControlSurface(jQuery('.mp-controls'))\n\n    // Properties for coordinating HTTP requests\n    this.requestPending = true\n    this.requestCancelled = false\n\n    this._init()\n  }\n\n  _init () {\n    const traceAction = () => {\n      this.mcs.disableCommands(['trace'])\n      this.mcs.startSpinning('trace')\n      this.mcs.enableCommands(['halt'])\n      this.rtv.showPendingMessage()\n\n      // Clear any pending notifications under the assumption that they\n      // were meant for a previous program\n      NotificationView.flush()\n\n      const payload = new TracePayload(this.edv.getProgram(), '')\n\n      const getTrace = (err, trace) => {\n        this.requestPending = false\n\n        // If the \"requestCancelled\" field has been set between when the\n        // request was dispatched and when the request was returned, cancel\n        // any logic that would have been run with the request response. This\n        // property was most likely set by the user clicking the \"Halt\" button\n        // between when they clicked the \"Run\" button and when the trace was\n        // returned from the server\n        if (this.requestCancelled === true) {\n          this.requestCancelled = false\n          return\n        }\n\n        this.mcs.stopSpinning('trace')\n\n        // Display appropriate notifications if there was an error or\n        // the given trace was well-formed but contains a runtime error\n        if (err !== null) {\n          // TODO\n          NotificationView.send('fatal', 'Bad trace!').open()\n          throw err\n        } else if (trace[0]['event'] === 'instruction_limit_reached') {\n          let notif = NotificationView.send('fatal', 'Error generating trace', {\n            large: true,\n            code: trace[0]['exception_msg'],\n            details: 'Trying again in a moment will likely fix this issue.',\n            actions: [\n              { name: 'Try Again', command: 'retry' }\n            ]\n          })\n\n          notif.on('retry', () => {\n            this.mcs.startSpinning('trace')\n            Network.getTrace(payload, getTrace)\n          })\n\n          notif.on('dismiss', () => {\n            throw new Error(trace[0]['exception_msg'])\n          })\n\n          notif.open()\n        } else {\n          this.rtv.render(trace)\n        }\n      }\n\n      // Reset the \"requestCancelled\" property before the request is issued so that\n      // if the property is set between now and when the request response is received\n      // the resonse can be ignored because the user no long wants it\n      this.requestCancelled = false\n      this.requestPending = true\n\n      Network.getTrace(payload, getTrace)\n    }\n\n    const haltAction = () => {\n      this.mcs.enableCommands(['trace'])\n      this.mcs.disableCommands(['halt'])\n      this.rtv.clear()\n      this.edv.unfreeze()\n      this.requestCancelled = true\n      this.mcs.stopSpinning('trace')\n    }\n\n    const resetAction = () => {\n      let [err, dropdownValue] = this.mcs.get('dropdown')\n\n      if (err !== null) {\n        console.error(err)\n        return\n      }\n\n      Storage.setWorkingCopyFromBuiltin(dropdownValue, (err, value) => {\n        if (err !== null) {\n          console.error(err)\n        } else {\n          console.log(`loaded builtin program \"${dropdownValue}\"`)\n          this.edv.setProgram(value)\n        }\n      })\n    }\n\n    const dropdownAction = (dropdownValue) => {\n      Storage.setWorkingCopyFromBuiltin(dropdownValue, (err, value) => {\n        if (err !== null) {\n          console.error(err)\n        } else {\n          console.log(`loaded builtin program \"${dropdownValue}\"`)\n          this.edv.setProgram(value)\n        }\n      })\n    }\n\n    this.mcs.on('trace', traceAction)\n    this.mcs.on('halt', haltAction)\n    this.mcs.on('reset', resetAction)\n    this.mcs.on('dropdown', dropdownAction)\n\n    this.rtv.on('set-trace-point', (line) => {\n      this.edv.freeze()\n      this.edv.highlightLine(line)\n    })\n\n    this.rtv.on('get-advice', () => {\n      traceAction()\n    })\n\n    // Handle loading either a default program or a saved program\n    // the user has already been editing\n    Storage.workingCopyExists((err, exists) => {\n      if (err !== null) {\n        console.error(err)\n        return\n      }\n\n      if (exists) {\n        // Use existing program from local storage\n        Storage.getWorkingCopy((err, value) => {\n          if (err !== null) {\n            console.error(err)\n          } else {\n            console.log('loaded working copy from local storage')\n\n            let matchingBuiltin = Storage.workingCopyMatchesBuiltin(value)\n\n            if (typeof matchingBuiltin === 'string') {\n              // Checks if a working copy is a perfect match for one of the\n              // simple builtin programs. This gracefully handles the situation where\n              // a builtin is loaded, not edited and the page reloads. The un-edited\n              // program was stored in local storage but the selector should still\n              // be set to the name of the builtin program\n              try {\n                this.mcs.set('dropdown', matchingBuiltin)\n              } catch (err) {\n                console.error(err)\n              }\n            } else {\n              try {\n                // If there exists a program in memory, set the control surface\n                // dropdown to \"custom\". This will avoid the situation where a previously\n                // edited program is loaded into the editor but the builtin program select\n                // still displays the name of some builtin program\n                this.mcs.set('dropdown', 'custom')\n              } catch (err) {\n                console.error(err)\n              }\n            }\n\n            this.edv.setProgram(value, true)\n          }\n        })\n      } else {\n        // Use some default program built-in as a starting program\n        Storage.setWorkingCopyFromBuiltin('tests', (err, value) => {\n          if (err !== null) {\n            console.error(err)\n          } else {\n            console.log('loaded default program as working copy')\n\n            try {\n              // Set the control surface dropdown to \"tests\" since the default\n              // program being loaded is the \"tests\" program. Then any clicks on\n              // the \"Reset\" button will reset the editor with the correct program\n              this.mcs.set('dropdown', 'tests')\n            } catch (err) {\n              console.error(err)\n            }\n\n            this.edv.setProgram(value, true)\n          }\n        })\n      }\n    })\n\n    // Set event listener so that before a user refreshes or closes the page,\n    // the working copy of the edited program source code will be saved\n    // inside the browser's local storage\n    window.onbeforeunload = () => {\n      Storage.setWorkingCopy(this.edv.getProgram(), (err, value) => {\n        if (err !== null) {\n          console.error(err)\n        } else {\n          console.log('saved working copy to local storage')\n        }\n      })\n    }\n  }\n}\n\nlet app = new AppView()\nwindow.app = app\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/app-view.js","import EventHandler from './event-handler'\n\nconst SPINNER_ON_CLASS = 'show-spinner'\nconst SPINNING_CLASS = 'icon-spinning'\n\nclass ControlSurface extends EventHandler {\n  constructor (wrapperElem) {\n    // Call EventHandler initialization code\n    super()\n\n    if ((wrapperElem instanceof jQuery) === false ||\n        jQuery(wrapperElem).hasClass('control-surface') === false) {\n      throw new Error('expected arg. to be a jQuery object with class \"control-surface\"')\n    }\n\n    // Gather all the button elements within the control surface\n    let buttonElems = jQuery(wrapperElem).find('.mp-control-button')\n    this.commands = jQuery(buttonElems).toArray().reduce((hash, buttonElem) => {\n      let command = jQuery(buttonElem).attr('data-command')\n      super.declareEvent(command)\n      hash[command] = buttonElem\n\n      jQuery(buttonElem).on('click', () => {\n        super.trigger(command, [])\n      })\n\n      return hash\n    }, {})\n\n    if (jQuery(wrapperElem).find('.spinner-wrapper').length !== 0) {\n      this.spinner = jQuery(wrapperElem).find('.spinner-wrapper')\n      this.spinnerOff()\n    } else {\n      this.spinner = null\n    }\n\n    if (jQuery(wrapperElem).find('.dropdown').length !== 0) {\n      this.dropdown = jQuery(wrapperElem).find('.dropdown')\n    } else {\n      this.dropdown = null\n    }\n  }\n\n  on (name, listener) {\n    if (name === 'dropdown' && this.dropdown !== null) {\n      jQuery(this.dropdown).on('change', () => {\n        listener.apply({}, [null, jQuery(this).val()])\n      })\n    } else {\n      super.on(name, listener)\n    }\n  }\n\n  get (command) {\n    if (command === 'dropdown') {\n      if (this.dropdown !== null) {\n        let dropdownValue = jQuery(this.dropdown).val()\n        return [null, dropdownValue]\n      }\n\n      let err = new Error(`control surface lacks <select> to support \"${command}\"`)\n      return [err, '']\n    }\n\n    let err = new Error(`command \"${command}\" is not available from this control surface`)\n    return [err, '']\n  }\n\n  set (command, value) {\n    switch (command) {\n      case 'dropdown':\n        if (this.dropdown === null) {\n          throw new Error(`control surface lacks <select> to support \"${command}\"`)\n        }\n\n        // Check that the <select> has an <option> with a matching value\n        if (jQuery(this.dropdown).find(`option[value=\"${value}\"]`).length > 0) {\n          jQuery(this.dropdown).val(value)\n        } else {\n          throw new Error(`<select> has no option with the value ${value}`)\n        }\n\n        break\n      default:\n        throw new Error(`command \"${command}\" is not available from this control surface`)\n    }\n  }\n\n  startSpinning (command) {\n    if (Object.keys(this.commands).includes(command) === false) {\n      throw new Error(`command \"${command}\" is not availalbe from this control surface`)\n    }\n\n    jQuery(this.commands[command]).addClass(SPINNING_CLASS)\n  }\n\n  stopSpinning (command) {\n    if (Object.keys(this.commands).includes(command) === false) {\n      throw new Error(`command \"${command}\" is not availalbe from this control surface`)\n    }\n\n    jQuery(this.commands[command]).removeClass(SPINNING_CLASS)\n  }\n\n  disableCommands (commands) {\n    if (Array.isArray(commands) === false) {\n      throw new Error('1st argument of ControlSurface.disableActions must be an array')\n    }\n\n    commands.forEach((command) => {\n      if (Object.keys(this.commands).includes(command) === false) {\n        throw new Error(`command \"${command}\" is not available from this control surface`)\n      }\n\n      // Disable the button\n      jQuery(this.commands[command])\n        .attr('disabled', true)\n    })\n  }\n\n  enableCommands (commands) {\n    if (Array.isArray(commands) === false) {\n      throw new Error('1st argument of ControlSurface.enableCommands must be an array')\n    }\n\n    commands.forEach((command) => {\n      if (Object.keys(this.commands).includes(command) === false) {\n        throw new Error(`command \"${command}\" is not available from this control surface`)\n      }\n\n      // Enable the button\n      jQuery(this.commands[command])\n        .attr('disabled', false)\n    })\n  }\n\n  spinnerOn () {\n    if (this.spinner !== null) {\n      jQuery(this.spinner).addClass(SPINNER_ON_CLASS)\n    }\n  }\n\n  spinnerOff () {\n    if (this.spinner !== null) {\n      jQuery(this.spinner).removeClass(SPINNER_ON_CLASS)\n    }\n  }\n}\n\nexport default ControlSurface\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/control-surface.js","class EventHandler {\n  constructor () {\n    this.events = {}\n  }\n\n  declareEvent (name) {\n    // Create a new property in the \"events\" object if it\n    // doesn't exist already\n    if (this.events.hasOwnProperty(name) === false || Array.isArray(this.events[name]) === false) {\n      this.events[name] = []\n    }\n  }\n\n  on (name, listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('expected 2nd arg. to be of type \"function\"')\n    }\n\n    if (this.events.hasOwnProperty(name) === false) {\n      throw new Error(`\"${name}\" is not a recognized event`)\n    }\n\n    // Add the event listening function to the list\n    this.events[name].push(listener)\n  }\n\n  off (name, listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('expected 2nd arg. to be of type \"function\"')\n    }\n\n    if (this.events[name].hasOwnProperty(name) === false) {\n      throw new Error(`\"${name}\" is not a recognized event`)\n    }\n\n    if (this.events[name].includes(listener) === false) {\n      throw new Error('event listener has not been attached yet')\n    }\n\n    // Get the index of the listener in the list of registered event listeners\n    let index = this.events[name].indexOf(listener)\n\n    // Remove that event listener function from the list\n    this.events[name].splice(index, 1)\n  }\n\n  trigger (name, payload) {\n    if (this.events.hasOwnProperty(name) === false && Array.isArray(this.events[name]) === false) {\n      throw new Error(`\"${name}\" is not a recognized event`)\n    }\n\n    // Call each event listener with the given payload\n    this.events[name].forEach((listener) => {\n      listener.apply({}, payload)\n    })\n  }\n}\n\nexport default EventHandler\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/event-handler.js","const HL_LINE_CLASS = 'active-line'\n\nclass EditorView {\n  constructor (wrapperElem, initialProgram = '') {\n    if ((wrapperElem instanceof jQuery) === false) {\n      throw new Error('expected argument to new EditorView() to be a jQuery object')\n    }\n\n    // HTML element that the CodeMirror instance is embedded within\n    this.wrapperElem = wrapperElem\n\n    // Create a new CodeMirror instance inside of the given wrapper\n    this.editor = CodeMirror(this.wrapperElem[0], {\n      mode: 'text/x-java',\n      theme: 'neat',\n      value: initialProgram,\n      lineNumbers: true,\n      indentUnit: 4,\n      smartIndent: false,\n      tabSize: 4,\n      indentWithTabs: true,\n      electricChars: false\n    })\n\n    // Line number of the line currently highlighted. Set to -1 if no line highlighted\n    this.highlightedLine = -1 // NOTE: 0-based line count\n\n    this.frozen = false\n  }\n\n  getProgram () {\n    return this.editor.getValue()\n  }\n\n  setProgram (newValue, clearHistory = false) {\n    if (typeof newValue !== 'string') {\n      throw new Error('expected 1st arg. of EditorView.setProgram() to be a string')\n    }\n\n    this.editor.setValue(newValue)\n\n    // If \"clearHistory\" is set, this will reset the editor's undo history\n    // so that it won't be possible to use the undo command to reverse\n    // changes made by \"setValue\"\n    if (clearHistory === true) {\n      this.editor.clearHistory()\n    }\n  }\n\n  freeze () {\n    this.frozen = true\n    this.editor.setOption('readOnly', 'nocursor')\n  }\n\n  unfreeze () {\n    this.frozen = false\n    this.editor.setOption('readOnly', false)\n    this.clearHighlightedLine()\n    this.editor.focus()\n  }\n\n  highlightLine (lineNum) {\n    if (this.frozen === false) {\n      throw new Error('cannot highlight line until editor is frozen')\n    }\n\n    // Convert lineNum from 1-based to 0-based\n    lineNum--\n\n    if (this.highlightedLine >= 0) {\n      this.clearHighlightedLine()\n    }\n\n    const PADDING = 20 // pixels that should be in-view above & below the line\n\n    this.editor.addLineClass(lineNum, 'gutter', HL_LINE_CLASS)\n    this.editor.addLineClass(lineNum, 'background', HL_LINE_CLASS)\n    this.editor.scrollIntoView({line: lineNum, ch: 0}, PADDING)\n    this.highlightedLine = lineNum\n  }\n\n  clearHighlightedLine () {\n    if (this.highlightedLine === -1) {\n      return\n    }\n\n    this.editor.removeLineClass(this.highlightedLine, 'gutter', HL_LINE_CLASS)\n    this.editor.removeLineClass(this.highlightedLine, 'background', HL_LINE_CLASS)\n    this.highlightedLine = -1\n  }\n\n  /*\n  showSuggestion (range: Range, message: string, snippet: string, acceptFn, declineFn) {\n    window.ConstantSuggestion(\n      range,\n      message.toString(),\n      snippet.toString(),\n      acceptFn,\n      declineFn)\n  }\n  */\n}\n\nexport default EditorView\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/editor-view.js","import NotificationView from './notification-view'\n\nclass Network {\n  static getTrace (payload, cb) {\n    const ajaxDone = (res) => {\n      return void cb(null, res)\n    }\n\n    const ajaxFail = (err) => {\n      let notif = NotificationView.send('fatal', 'Network error getting trace', {\n        large: true,\n        details: 'Trying again in a moment will likely fix this issue.',\n        actions: [\n          { name: 'Try Again', command: 'retry' }\n        ]\n      })\n\n      notif.on('retry', () => {\n        // Call \"getTrace\" again with same arguments\n        Network.getTrace(payload, cb)\n      })\n\n      notif.on('dismiss', () => {\n        // Notification has been dismissed without using the \"Try Again\" action\n        cb(err, [])\n      })\n\n      notif.open()\n    }\n\n    superagent\n    .post('/trace')\n    .send(payload.stringify())\n    .end((err, res) => {\n      if (err || res.ok !== true) {\n        ajaxFail(err)\n      } else {\n        let parsedTrace = {}\n\n        try {\n          parsedTrace = JSON.parse(res.text)\n        } catch (err) {\n          ajaxFail()\n        }\n\n        ajaxDone(parsedTrace.trace)\n      }\n    })\n  }\n}\n\nexport default Network\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/network.js","import EventHandler from './event-handler'\nimport { sanitize } from './util'\n\nconst NOTIF_TYPES = [\n  'fatal',\n  'alert',\n  'info',\n  'success'\n]\n\nclass Notification extends EventHandler {\n  constructor (parentElem, type, title, opts) {\n    super()\n\n    // Triggered when the notification is resolved with no actions\n    super.declareEvent('dismiss')\n\n    // Triggered WHENEVER a notification is resolved\n    super.declareEvent('close')\n\n    if (NOTIF_TYPES.includes(type) === false) {\n      throw new Error(`\"${type}\" is an invlaid notification type`)\n    }\n\n    this.parent = parentElem\n    this.type = type\n    this.title = sanitize(title)\n    this.large = opts.large === true\n\n    if (typeof opts.code === 'string') {\n      this.hasCode = true\n      this.code = sanitize(opts.code).replace('\\n', '<br>')\n    } else {\n      this.hasCode = false\n      this.code = ''\n    }\n\n    if (typeof opts.details === 'string') {\n      this.hasDetails = true\n      this.details = sanitize(opts.details)\n    } else {\n      this.hasDetails = false\n    }\n\n    this.actions = []\n\n    if (Array.isArray(opts.actions)) {\n      this.actions = opts.actions.reduce((actions, action) => {\n        if (action.hasOwnProperty('name') && action.hasOwnProperty('command') &&\n          typeof action.name === 'string' && typeof action.command === 'string') {\n          // Add just the action \"name\" and \"command\" to the list of notification actions\n          actions = actions.concat({\n            name: action.name,\n            command: action.command\n          })\n\n          // Add the command to the list of accepted event commands\n          super.declareEvent(action.command)\n        }\n\n        return actions\n      }, [])\n    }\n\n    this.expired = false\n  }\n\n  on (name, listener) {\n    if (this.expired === true) {\n      throw new Error('notification has expired')\n    }\n\n    super.on(name, listener)\n  }\n\n  trigger (name, payload) {\n    if (this.expired === true) {\n      throw new Error('notification has expired')\n    }\n\n    super.trigger(name, payload)\n  }\n\n  open () {\n    if (this.expired === true) {\n      throw new Error('notification has expired')\n    }\n\n    if ((this.parent instanceof jQuery) === false) {\n      throw new Error('notification has not parent element')\n    }\n\n    let html = ''\n\n    html += `<div class=\"notif ${this.type} ${this.large === true ? 'large' : ''}\">`\n    html += '<div class=\"tag\"></div>'\n\n    if (this.large) {\n      html += '<button class=\"dismiss\" title=\"Dismiss\"></button>'\n    }\n\n    html += '<div class=\"content\">'\n    html += `<p class=\"title\">${this.title}</p>`\n\n    if (this.hasCode) {\n      html += `<code>${this.code}</code>`\n    }\n\n    if (this.hasDetails) {\n      html += `<p class=\"details\">${this.details}</p>`\n    }\n\n    if (this.actions.length > 0) {\n      html += this.actions.reduce((html, action) => {\n        return html + `<button class=\"action\" data-command=\"${action.command}\">${action.name}</button>`\n      }, '')\n    }\n\n    html += '</div>' // end of .content\n    html += '</div>' // end of .notif\n\n    let elem = jQuery(html)\n\n    elem.find('button.dismiss').on('click', () => {\n      this.trigger('dismiss', [])\n      this.close()\n    })\n\n    elem.find('button[data-command]').on('click', (event) => {\n      let btn = jQuery(event.currentTarget)\n\n      let command = btn.attr('data-command')\n\n      if (typeof command === 'string') {\n        this.trigger(command, [])\n      }\n    })\n\n    this.elem = elem\n    jQuery(this.parent).append(elem)\n\n    if (this.large === false) {\n      setTimeout(() => {\n        this.trigger('dismiss', [])\n      }, 4000)\n    }\n  }\n\n  close () {\n    if ((this.elem instanceof jQuery) === false) {\n      throw new Error('notification has not been rendered yet')\n    }\n\n    // The addition of the \"close\" class triggers the\n    // notification's exit animation\n    this.elem.addClass('close')\n\n    // Run the tear-down code when the notification's\n    // exit animation has finished running\n    setTimeout(() => {\n      this.elem.remove()\n      this.elem = null\n      this.parent = null\n      this.expired = true\n    }, 300)\n  }\n}\n\nconst NOTIF_VIEW_SELECTOR = '.notif-bucket'\n\nlet pendingNotifications = []\n\nclass NotificationView {\n  static getElem () {\n    return jQuery(NOTIF_VIEW_SELECTOR)\n  }\n\n  static send (type, title, opts = {}) {\n    let elem = NotificationView.getElem()\n    let notif = new Notification(elem, type, title, opts)\n\n    pendingNotifications.push(notif)\n    notif.on('close', () => {\n      let index = pendingNotifications.indexOf(notif)\n      pendingNotifications.splice(index, 1)\n    })\n\n    return notif\n  }\n\n  static flush () {\n    pendingNotifications.forEach((notif) => {\n      notif.close()\n    })\n  }\n}\n\nexport default NotificationView\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/notification-view.js","const TAG_REPLACEMENTS = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt'\n}\n\nexport const sanitize = function (dirty) {\n  if (typeof dirty !== 'string') {\n    dirty = `${dirty}`\n  }\n\n  return dirty.replace(/[&<>]/g, (tag) => TAG_REPLACEMENTS[tag] || tag)\n}\n\nexport const htmlBuilder = function (elements) {\n  return elements.reduce((out, elem) => out + elem, '')\n}\n\nconst VALID_TAGS = [\n  ['input', true],\n  ['label', false],\n  ['li', false],\n  ['span', false]\n]\n\nconst VALID_FIELDS = [\n  'children',\n  'classes',\n  'for',\n  'id',\n  'name',\n  'placeholder',\n  'type',\n  'value'\n]\n\nVALID_TAGS.forEach((tagInfo) => {\n  const tagName = tagInfo[0]\n  const selfClosing = tagInfo[1]\n\n  htmlBuilder[tagName] = function (first, second) {\n    if (typeof first === 'string') {\n      // Assume \"first\" argument is a class descriptor\n      if (typeof second === 'string') {\n        // Assume \"second\" argument is an HTML string\n        if (selfClosing) {\n          throw new Error(`self closing tags like ${tagName} can not have children`)\n        }\n\n        return `<${tagName} class=\"${first}\">${second}</${tagName}>`\n      } else if (typeof second === 'undefined') {\n        // \"second\" is undefined\n        if (selfClosing) {\n          return `<${tagName}>`\n        } else {\n          return `<${tagName}></${tagName}>`\n        }\n      } else if (Array.isArray(second)) {\n        // Assume \"second\" argument is an array of HTML strings\n        return `<${tagName} class=\"${first}\">${second.join('')}</${tagName}>`\n      } else {\n        console.log(second)\n        throw new Error('un-recognized type of second argument')\n      }\n    } else if (Array.isArray(first)) {\n      if (selfClosing) {\n        throw new Error(`self closing tags like ${tagName} can not have children`)\n      }\n\n      return `<${tagName}>${first.join('')}</${tagName}>`\n    } else if (typeof first === 'object') {\n      // Assume \"first\" is a config object\n      let attrs = Object.keys(first).reduce((attrs, attrName) => {\n        // Ignore any attribute names that are part of prototype objects\n        if (first.hasOwnProperty(attrName) === false) {\n          return attrs\n        }\n\n        // Ignore this field during this stage\n        if (attrName === 'children') {\n          return attrs\n        }\n\n        // Allow any fields prefixed with the string \"data-\" and followed by\n        // 0 or more alphanumeric, underscore, or hyphen characters\n        if (/^data-[a-zA-Z0-9\\-_]*$/.test(attrName)) {\n          return attrs + ` ${attrName}=\"${first[attrName]}\"`\n        }\n\n        // Allow explicitly defined legal attribute names\n        if (VALID_FIELDS.includes(attrName)) {\n          if (attrName === 'classes') {\n            // Handle the \"classes\" field specially\n            if (Array.isArray(attrName['classes'])) {\n              // Handle classes when given as an array\n              return attrs + ` class=\"${first['classes'].join(' ')}\"`\n            } else {\n              // Handle classes when given as a single string\n              return attrs + ` class=\"${first['classes']}\"`\n            }\n          } else {\n            return attrs + ` ${attrName}=\"${first[attrName]}\"`\n          }\n        }\n\n        throw new Error(`un-recognized attribute named: \"${attrName}\"`)\n      }, '')\n\n      // Emit an error if a self-closing tag defines child elements so that\n      // elements are not silently ignored\n      if (selfClosing && Array.isArray(first.children)) {\n        throw new Error(`self closing tags like ${tagName} can not have children`)\n      }\n\n      let children = ''\n\n      if (typeof first.children === 'undefined') {\n        children = ''\n      } else if (typeof first.children === 'string') {\n        // Accept a string for the children field\n        children = first.children\n      } else if (first.children instanceof Array) {\n        // Convert children to strings then concatenate\n        children = first.children.map((child) => child.toString()).join('')\n      } else {\n        // Emit an error if the \"children\" field was of some other type\n        console.error(first)\n        throw new Error('un-recognized type of children field')\n      }\n\n      if (selfClosing) {\n        return `<${tagName}${attrs}>`\n      } else {\n        return `<${tagName}${attrs}>${children}</${tagName}>`\n      }\n    }\n\n    throw new Error('could not parse htmlBuilder inputs')\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/util.js","import EventHandler from './event-handler'\nimport ControlSurface from './control-surface'\nimport NotificationView from './notification-view'\nimport { htmlBuilder, sanitize } from './util'\n\nclass RuntimeView extends EventHandler {\n  constructor (wrapperElem) {\n    // Call EventHandler initialization code\n    super()\n\n    // Attach events to the RuntimeView's control surface\n    this.cs = new ControlSurface(wrapperElem.find('.control-surface'))\n    this.cs.disableCommands(['step-backward', 'step-forward'])\n\n    // Listen for clicks to the step-backward button on the control surface to\n    // move the trace's execution point backward by 1. If the user is already at\n    // the start of the trace, the point stays the same\n    this.cs.on('step-backward', () => {\n      if (this.rendered === true && this.index - 1 >= 0) {\n        this.setVisiblePoint(this.index - 1)\n      }\n    })\n\n    // Listen for clicks to the step-forward button on the control surface to\n    // move the trace's execution point forward by 1. If the user is already at\n    // the end of the trace, the point stays the same\n    this.cs.on('step-forward', () => {\n      if (this.rendered === true && this.index + 1 < this.trace.length) {\n        this.setVisiblePoint(this.index + 1)\n      }\n    })\n\n    // Set \"wrapperElem\" property & significant children elements\n    this.wrapperElem = wrapperElem\n    this.visualizationElem = wrapperElem.find('.trace-visualization')\n    this.variablesElem = wrapperElem.find('.variables-wrapper')\n\n    if (this.visualizationElem.length < 1) {\n      throw new Error('missing .trace-visualization element')\n    }\n\n    if (this.variablesElem.length < 1) {\n      throw new Error('missing .variables-wrapper element')\n    }\n\n    // Define events that can be emitted by RuntimeView objects. set-trace-point\n    // events are emitted whenever the user changes the currently viewed\n    // execution point. get-advice events are emitted whenever the user has\n    // specified a variable's target value and indicates that they want the app\n    // to suggest some changes\n    super.declareEvent('set-trace-point')\n    super.declareEvent('get-advice')\n\n    // A boolean flag indicating whether this view is populated with program\n    // trace data. If it isn't populated, the step-forward and step-backward\n    // buttons won't trigger any actions\n    this.rendered = false\n\n    // A cached copy of the current trace & scope data\n    this.trace = []\n    this.scope = {}\n\n    // Current trace point being displayed\n    this.index = 0\n\n    // Display \"pending\" messages in the visualization and variable views\n    this.showPendingMessage()\n  }\n\n  render (trace) {\n    if (Array.isArray(trace) === false) {\n      throw new Error(`trace must be an array, received ${typeof trace}`)\n    }\n\n    // The visualization of the execution trace is built last-to-first\n    // so that function return values can be collected before their\n    // signature, argument, and return values have to be added to the\n    // visualization. A stack of return values is kept as the trace is\n    // traversed so whenever a \"call\" event is encountered, the topmost\n    // return value is popped and used as the return value\n    let returnValueStack = []\n\n    let html = ''\n\n    html += htmlBuilder([\n      '<div class=\"scope top-level\">',\n      '<ol class=\"execution\">'\n    ])\n\n    html += trace.reduceRight((html, point, index) => {\n      let lineNum = sanitize(point['line'])\n      let pointHtml = ''\n\n      switch (point['event']) {\n        case 'instruction_limit_reached':\n          NotificationView.send('fatal', 'VM reached instruction limit', {\n            large: true,\n            code: point['exception_msg']\n          }).open()\n\n          return html\n\n        case 'call':\n          // Collect a list of the function call's argument values\n          let args = {}\n\n          try {\n            args = point['stack_to_render'][0]['encoded_locals']\n          } catch (err) {\n            throw new Error(`cannot get local variables of point ${index}`)\n          }\n\n          let argsHtml = Object.keys(args).reduce((html, argName) => {\n            // Ignore any argument names that are part of prototype objects\n            if (args.hasOwnProperty(argName) === false) {\n              return html\n            }\n\n            return html.concat(htmlBuilder([\n              htmlBuilder.span('sig-name', argName),\n              htmlBuilder.span('sig-syntax', ':'),\n              htmlBuilder.span('sig-value', `${args[argName]}`)\n            ]))\n          }, []).join(htmlBuilder.span('sig-syntax', ','))\n\n          let funcName = sanitize(point['func_name'])\n          let returnValue = sanitize(returnValueStack.pop())\n\n          if (typeof returnValue !== 'string') {\n            throw new Error('call with no return value')\n          }\n\n          pointHtml = htmlBuilder([\n            // Render only the open tag since the closing tag was rendered\n            // when the corresponding \"return\" trace point was rendered\n            '<li class=\"point call expanded\">',\n\n            // Hidden radio button used to ensure that there can't be more\n            // than 1 trace point selected at a time\n            htmlBuilder.input({\n              type: 'radio',\n              id: `point-${index}`,\n              classes: ['point-radio-button'],\n              name: 'point',\n              value: index,\n              'data-line': lineNum\n            }),\n\n            // Label element is the visual representation of the trace point\n            // on screen including the function signature and the line-dot icon\n            htmlBuilder.label({\n              classes: ['func-sig'],\n              for: `point-${index}`,\n              children: [\n                htmlBuilder.span('sig-method', `${funcName}`),\n                htmlBuilder.span('sig-syntax', '('),\n                argsHtml,\n                htmlBuilder.span('sig-syntax', ')'),\n                htmlBuilder.span('sig-syntax', '&xrArr;'),\n                htmlBuilder.span('sig-value field', returnValue)\n              ]\n            }),\n\n            // Render only the open tags since the closing tags were rendered\n            // when the corresponding \"return\" trace point was rendered\n            '<div class=\"scope\">',\n            '<ol class=\"execution\">'\n          ])\n\n          return pointHtml + html\n\n        case 'return':\n        case 'step_line':\n          let isReturn = (point['event'] === 'return')\n\n          // If this point is a return point, append the return value\n          // to the stack of return values so the corresponding \"call\" trace\n          // point can use that value in its function signature\n          if (isReturn) {\n            let returnValue = 'void'\n\n            try {\n              returnValue = point['stack_to_render'][0]['encoded_locals']['__return__'].toString()\n            } catch (err) {\n              throw new Error(`cannot get \"__return__\" field of point ${index}`)\n            }\n\n            returnValueStack.push(sanitize(returnValue))\n          }\n\n          pointHtml = htmlBuilder([\n            htmlBuilder.li('point', [\n              htmlBuilder.input({\n                type: 'radio',\n                id: `point-${index}`,\n                classes: ['point-radio-button'],\n                name: 'point',\n                value: index,\n                'data-line': lineNum\n              }),\n              htmlBuilder.label({\n                for: `point-${index}`\n              })\n            ]),\n\n            // Closing tags that correspond to open tags rendered for the\n            // corresponding \"call\" trace point\n            isReturn ? '</ol>' : '',\n            isReturn ? '</div>' : '',\n            isReturn ? '</li>' : ''\n          ])\n\n          return pointHtml + html\n\n        default:\n          console.error(point)\n          throw new Error(`cannot handle point at index ${index}`)\n      }\n    }, '')\n\n    html += htmlBuilder([\n      '</div>',\n      '</ol>'\n    ])\n\n    // Insert the HTML into the DOM\n    this.visualizationElem.html(html)\n\n    // Attach event listeners to the newly created visualization HTML\n    this.visualizationElem.find('.scope input[type=\"radio\"]').on('click', (event) => {\n      let id = jQuery(event.currentTarget).attr('id')\n      let index = parseInt(id.replace('point-', ''), 10)\n\n      // Ensure that no corrosive values like NaN escape into the rest of the logic\n      if (isNaN(index)) {\n        index = 0\n      }\n\n      this.setVisiblePoint(index)\n    })\n\n    // Cache the trace data\n    this.trace = trace\n\n    // Set the \"rendered\" flag to true\n    this.rendered = true\n\n    this.initializeVariableView()\n\n    // View the first execution point\n    this.setVisiblePoint(0)\n\n    // Enable forward, backward navigation buttons\n    this.cs.enableCommands(['step-backward', 'step-forward'])\n  }\n\n  showPendingMessage () {\n    const html = '<p class=\"pending\">waiting for execution trace&hellip;</p>'\n    this.rendered = false\n\n    this.visualizationElem.html(html)\n    this.variablesElem.html(html)\n  }\n\n  clear () {\n    // Reset stateful properties of the view\n    this.rendered = false\n    this.trace = []\n    this.scope = {}\n    this.index = 0\n\n    // Disable commands since there's not data to manipulate\n    this.cs.disableCommands(['step-backward', 'step-forward'])\n\n    // Replace any HTML embedded in the trace or variable views with\n    // a basic \"pending\" message\n    this.showPendingMessage()\n  }\n\n  setVisiblePoint (index) {\n    if (this.rendered === true) {\n      if (index >= this.trace.length || index < 0) {\n        throw new Error(`index ${index} is out of range`)\n      }\n\n      let radioButton = this.wrapperElem.find(`.point-radio-button:eq(${index})`)\n      let line = parseInt(radioButton.attr('data-line'))\n\n      if (isNaN(line)) {\n        throw new Error(`button at index ${index} has corrupted \"data-line\" property`)\n      }\n\n      // If everything checks out, commit to the change\n      this.index = index\n      radioButton.prop('checked', true)\n      this.setVisibleScope(index)\n      super.trigger('set-trace-point', [line])\n    }\n  }\n\n  initializeVariableView () {\n    if (this.rendered === true) {\n      let variableListHtml = '<ol></ol>'\n      let suggestBtnHtml = '<button class=\"action-button success\" disabled>Get suggestions</button>'\n      let cancelBtnHtml = '<button class=\"action-button\" disabled>Cancel</button>'\n      this.variablesElem.html(variableListHtml + suggestBtnHtml + cancelBtnHtml)\n    }\n  }\n\n  setVisibleScope (index) {\n    if (this.rendered === true) {\n      if (index >= this.trace.length || index < 0) {\n        throw new Error(`index ${index} is out of range`)\n      }\n\n      let point = this.trace[index]\n      let callstack = point['stack_to_render']\n\n      if (Array.isArray(callstack) === false) {\n        throw new Error(`malformed scope at index ${index}`)\n      }\n\n      if (callstack.length > 0) {\n        let topCallstack = callstack[0]\n        let locals = topCallstack['encoded_locals'] || {}\n        let variablesHtml = Object.keys(locals).reduce((html, localName) => {\n          if (locals.hasOwnProperty(localName) === false) {\n            return html\n          }\n\n          return html + htmlBuilder.li([\n            htmlBuilder.span('current', [\n              htmlBuilder.span('name', sanitize(localName)),\n              htmlBuilder.span('value field', sanitize(locals[localName]))\n            ]),\n            ' &xrarr; ',\n            htmlBuilder.input({\n              type: 'textbox',\n              classes: ['edit'],\n              placeholder: '?'\n            })\n          ])\n        }, '')\n\n        this.variablesElem.find('ol').html(variablesHtml)\n      }\n    }\n  }\n}\n\nexport default RuntimeView\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/runtime-view.js","const WORKING_PROGRAM_KEY = 'working_program_copy'\n\nconst BUILTIN_PROGRAMS = {\n  'tests': `public class Main {\n    static int SimpleJava() {\n        int a = 2;\n        int b = a + 1;\n        int c = a + b;\n        return c;\n    }\n\n    public static void main(String[] args) {\n        int x = SimpleJava();\n        System.out.println(x);\n    }\n}`,\n  'hello': `public class HelloWorld {\n    public static void main(String[] args) {\n        System.out.println(\"Hello world\");\n    }\n}`,\n  'custom': ``\n}\n\nclass Storage {\n  static workingCopyExists (cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('expected 1st arg. of Storage.workingCopyExists() to be a function')\n    }\n\n    localforage.getItem(WORKING_PROGRAM_KEY)\n      .then((value) => {\n        let exists = (typeof value === 'string')\n        cb.apply({}, [null, exists])\n      })\n      .catch((err) => {\n        cb.apply({}, [err])\n      })\n  }\n\n  static getWorkingCopy (cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('expected 1st arg. of Storage.getWorkingCopy() to be a function')\n    }\n\n    localforage.getItem(WORKING_PROGRAM_KEY)\n      .then((value) => {\n        if (typeof value !== 'string') {\n          value = ''\n        }\n\n        cb.apply({}, [null, value])\n      })\n      .catch((err) => {\n        cb.apply({}, [err])\n      })\n  }\n\n  static setWorkingCopy (newValue, cb) {\n    if (typeof newValue !== 'string') {\n      throw new Error('expected 1st arg. of Storage.setWorkingCopy() to be a string')\n    }\n\n    if (typeof cb !== 'function') {\n      throw new Error('expected 2nd arg. of Storage.setWorkingCopy() to be a function')\n    }\n\n    localforage.setItem(WORKING_PROGRAM_KEY, newValue)\n      .then((value) => {\n        cb.apply({}, [null, value])\n      })\n      .catch((err) => {\n        cb.apply({}, [err])\n      })\n  }\n\n  static setWorkingCopyFromBuiltin (builtinID, cb) {\n    if (typeof builtinID !== 'string') {\n      let err = new Error('expected 1st arg. of Storage.setWorkingCopyFromDefault() to be a string')\n      return void cb.apply({}, [err])\n    }\n\n    if (BUILTIN_PROGRAMS.hasOwnProperty(builtinID) === false) {\n      let err = new Error('1st arg. of Storage.setWorkingCopyFromDefault() not a valid ID')\n      return void cb.apply({}, [err])\n    }\n\n    if (typeof cb !== 'function') {\n      let err = new Error('expected 3rd arg. of Storage.setWorkingCopy() to be a function')\n      return void cb.apply({}, [err])\n    }\n\n    Storage.setWorkingCopy(BUILTIN_PROGRAMS[builtinID], cb)\n  }\n\n  static clear (force = false) {\n    if (force === true || window.confirm('Clear local storage?')) {\n      localforage.clear()\n        .then(() => {\n          console.log('Local storage cleared')\n        })\n        .catch((err) => {\n          console.error('Could not clear local storage. Error has been logged')\n          console.error(err)\n        })\n    }\n  }\n\n  static workingCopyMatchesBuiltin (testProgram) {\n    let keys = Object.keys(BUILTIN_PROGRAMS)\n\n    for (let i = 0, len = keys.length; i < len; i++) {\n      let key = keys[i]\n\n      if (BUILTIN_PROGRAMS[key] === testProgram) {\n        return key\n      }\n    }\n\n    return false\n  }\n}\n\nexport default Storage\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/storage.js","class TracePayload {\n  constructor (source, stdin) {\n    this.source = source\n    this.stdin = stdin\n  }\n\n  stringify () {\n    return JSON.stringify({\n      source: this.source,\n      input: this.stdin\n    })\n  }\n}\n\nexport default TracePayload\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/client/trace-payload.js"],"sourceRoot":""}
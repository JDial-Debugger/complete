!function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};a?a=a.next=s:(i=a=s,r(e,t))})}function r(n,i){try{var a=t[n](i),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(){t(this,e),this.events={}}return n(e,[{key:"declareEvent",value:function(e){this.events.hasOwnProperty(e)!==!1&&Array.isArray(this.events[e])!==!1||(this.events[e]=[])}},{key:"on",value:function(e,t){if("function"!=typeof t)throw new Error('expected 2nd arg. to be of type "function"');if(this.events.hasOwnProperty(e)===!1)throw new Error('"'+e+'" is not a recognized event');this.events[e].push(t)}},{key:"off",value:function(e,t){if("function"!=typeof t)throw new Error('expected 2nd arg. to be of type "function"');if(this.events[e].hasOwnProperty(e)===!1)throw new Error('"'+e+'" is not a recognized event');if(this.events[e].includes(t)===!1)throw new Error("event listener has not been attached yet");var n=this.events[e].indexOf(t);this.events[e].splice(n,1)}},{key:"trigger",value:function(e,t){if(this.events.hasOwnProperty(e)===!1&&Array.isArray(this.events[e])===!1)throw new Error('"'+e+'" is not a recognized event');this.events[e].forEach(function(e){e.apply({},t)})}}]),e}(),c="show-spinner",l="icon-spinning",u=function(e){function a(e){t(this,a);var n=i(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(e instanceof jQuery==!1||jQuery(e).hasClass("control-surface")===!1)throw new Error('expected arg. to be a jQuery object with class "control-surface"');var o=jQuery(e).find(".mp-control-button");return n.commands=jQuery(o).toArray().reduce(function(e,t){var o=jQuery(t).attr("data-command");return r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"declareEvent",n).call(n,o),e[o]=t,jQuery(t).on("click",function(){r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"trigger",n).call(n,o,[])}),e},{}),0!==jQuery(e).find(".spinner-wrapper").length?(n.spinner=jQuery(e).find(".spinner-wrapper"),n.spinnerOff()):n.spinner=null,0!==jQuery(e).find(".dropdown").length?n.dropdown=jQuery(e).find(".dropdown"):n.dropdown=null,n}return o(a,e),n(a,[{key:"on",value:function(e,t){var n=this;"dropdown"===e&&null!==this.dropdown?jQuery(this.dropdown).on("change",function(){t.apply({},[null,jQuery(n).val()])}):r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"on",this).call(this,e,t)}},{key:"get",value:function(e){if("dropdown"===e){if(null!==this.dropdown){var t=jQuery(this.dropdown).val();return[null,t]}var n=new Error('control surface lacks <select> to support "'+e+'"');return[n,""]}var r=new Error('command "'+e+'" is not available from this control surface');return[r,""]}},{key:"set",value:function(e,t){switch(e){case"dropdown":if(null===this.dropdown)throw new Error('control surface lacks <select> to support "'+e+'"');if(!(jQuery(this.dropdown).find('option[value="'+t+'"]').length>0))throw new Error("<select> has no option with the value "+t);jQuery(this.dropdown).val(t);break;default:throw new Error('command "'+e+'" is not available from this control surface')}}},{key:"startSpinning",value:function(e){if(Object.keys(this.commands).includes(e)===!1)throw new Error('command "'+e+'" is not availalbe from this control surface');jQuery(this.commands[e]).addClass(l)}},{key:"stopSpinning",value:function(e){if(Object.keys(this.commands).includes(e)===!1)throw new Error('command "'+e+'" is not availalbe from this control surface');jQuery(this.commands[e]).removeClass(l)}},{key:"disableCommands",value:function(e){var t=this;if(Array.isArray(e)===!1)throw new Error("1st argument of ControlSurface.disableActions must be an array");e.forEach(function(e){if(Object.keys(t.commands).includes(e)===!1)throw new Error('command "'+e+'" is not available from this control surface');jQuery(t.commands[e]).attr("disabled",!0)})}},{key:"enableCommands",value:function(e){var t=this;if(Array.isArray(e)===!1)throw new Error("1st argument of ControlSurface.enableCommands must be an array");e.forEach(function(e){if(Object.keys(t.commands).includes(e)===!1)throw new Error('command "'+e+'" is not available from this control surface');jQuery(t.commands[e]).attr("disabled",!1)})}},{key:"spinnerOn",value:function(){null!==this.spinner&&jQuery(this.spinner).addClass(c)}},{key:"spinnerOff",value:function(){null!==this.spinner&&jQuery(this.spinner).removeClass(c)}}]),a}(s),d="active-line",f=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t(this,e),n instanceof jQuery==!1)throw new Error("expected argument to new EditorView() to be a jQuery object");this.wrapperElem=n,this.editor=CodeMirror(this.wrapperElem[0],{mode:"text/x-java",theme:"neat",value:r,lineNumbers:!0,indentUnit:4,smartIndent:!1,tabSize:4,indentWithTabs:!0,electricChars:!1}),this.highlightedLine=-1,this.frozen=!1}return n(e,[{key:"getProgram",value:function(){return this.editor.getValue()}},{key:"setProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof e)throw new Error("expected 1st arg. of EditorView.setProgram() to be a string");this.editor.setValue(e),t===!0&&this.editor.clearHistory()}},{key:"freeze",value:function(){this.frozen=!0,this.editor.setOption("readOnly","nocursor")}},{key:"unfreeze",value:function(){this.frozen=!1,this.editor.setOption("readOnly",!1),this.clearHighlightedLine(),this.editor.focus()}},{key:"highlightLine",value:function(e){if(this.frozen===!1)throw new Error("cannot highlight line until editor is frozen");e--,this.highlightedLine>=0&&this.clearHighlightedLine();var t=20;this.editor.addLineClass(e,"gutter",d),this.editor.addLineClass(e,"background",d),this.editor.scrollIntoView({line:e,ch:0},t),this.highlightedLine=e}},{key:"clearHighlightedLine",value:function(){this.highlightedLine!==-1&&(this.editor.removeLineClass(this.highlightedLine,"gutter",d),this.editor.removeLineClass(this.highlightedLine,"background",d),this.highlightedLine=-1)}}]),e}(),p={"&":"&amp;","<":"&lt;",">":"&gt"},h=function(e){return"string"!=typeof e&&(e=""+e),e.replace(/[&<>]/g,function(e){return p[e]||e})},y=function(e){return e.reduce(function(e,t){return e+t},"")},g=[["input",!0],["label",!1],["li",!1],["span",!1]],v=["children","classes","for","id","name","placeholder","type","value"];g.forEach(function(t){var n=t[0],r=t[1];y[n]=function(t,o){if("string"==typeof t){if("string"==typeof o){if(r)throw new Error("self closing tags like "+n+" can not have children");return"<"+n+' class="'+t+'">'+o+"</"+n+">"}if("undefined"==typeof o)return r?"<"+n+">":"<"+n+"></"+n+">";if(Array.isArray(o))return"<"+n+' class="'+t+'">'+o.join("")+"</"+n+">";throw console.log(o),new Error("un-recognized type of second argument")}if(Array.isArray(t)){if(r)throw new Error("self closing tags like "+n+" can not have children");return"<"+n+">"+t.join("")+"</"+n+">"}if("object"===("undefined"==typeof t?"undefined":e(t))){var i=Object.keys(t).reduce(function(e,n){if(t.hasOwnProperty(n)===!1)return e;if("children"===n)return e;if(/^data-[a-zA-Z0-9\-_]*$/.test(n))return e+(" "+n+'="'+t[n]+'"');if(v.includes(n))return"classes"===n?Array.isArray(n.classes)?e+(' class="'+t.classes.join(" ")+'"'):e+(' class="'+t.classes+'"'):e+(" "+n+'="'+t[n]+'"');throw new Error('un-recognized attribute named: "'+n+'"')},"");if(r&&Array.isArray(t.children))throw new Error("self closing tags like "+n+" can not have children");var a="";if("undefined"==typeof t.children)a="";else if("string"==typeof t.children)a=t.children;else{if(!(t.children instanceof Array))throw console.error(t),new Error("un-recognized type of children field");a=t.children.map(function(e){return e.toString()}).join("")}return r?"<"+n+i+">":"<"+n+i+">"+a+"</"+n+">"}throw new Error("could not parse htmlBuilder inputs")}});var m=["fatal","alert","info","success"],w=function(e){function a(e,n,o,s){t(this,a);var c=i(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"declareEvent",c).call(c,"dismiss"),r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"declareEvent",c).call(c,"close"),m.includes(n)===!1)throw new Error('"'+n+'" is an invlaid notification type');return c.parent=e,c.type=n,c.title=h(o),c.large=s.large===!0,"string"==typeof s.code?(c.hasCode=!0,c.code=h(s.code).replace("\n","<br>")):(c.hasCode=!1,c.code=""),"string"==typeof s.details?(c.hasDetails=!0,c.details=h(s.details)):c.hasDetails=!1,c.actions=[],Array.isArray(s.actions)&&(c.actions=s.actions.reduce(function(e,t){return t.hasOwnProperty("name")&&t.hasOwnProperty("command")&&"string"==typeof t.name&&"string"==typeof t.command&&(e=e.concat({name:t.name,command:t.command}),r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"declareEvent",c).call(c,t.command)),e},[])),c.expired=!1,c}return o(a,e),n(a,[{key:"on",value:function(e,t){if(this.expired===!0)throw new Error("notification has expired");r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"on",this).call(this,e,t)}},{key:"trigger",value:function(e,t){if(this.expired===!0)throw new Error("notification has expired");r(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"trigger",this).call(this,e,t)}},{key:"open",value:function(){var e=this;if(this.expired===!0)throw new Error("notification has expired");if(this.parent instanceof jQuery==!1)throw new Error("notification has not parent element");var t="";t+='<div class="notif '+this.type+" "+(this.large===!0?"large":"")+'">',t+='<div class="tag"></div>',this.large&&(t+='<button class="dismiss" title="Dismiss"></button>'),t+='<div class="content">',t+='<p class="title">'+this.title+"</p>",this.hasCode&&(t+="<code>"+this.code+"</code>"),this.hasDetails&&(t+='<p class="details">'+this.details+"</p>"),this.actions.length>0&&(t+=this.actions.reduce(function(e,t){return e+('<button class="action" data-command="'+t.command+'">'+t.name+"</button>")},"")),t+="</div>",t+="</div>";var n=jQuery(t);n.find("button.dismiss").on("click",function(){try{e.trigger("dismiss",[])}finally{e.close()}}),n.find("button[data-command]").on("click",function(t){var n=jQuery(t.currentTarget),r=n.attr("data-command");if("string"==typeof r)try{e.trigger(r,[])}finally{e.close()}}),this.elem=n,jQuery(this.parent).append(n),this.large===!1&&setTimeout(function(){e.trigger("dismiss",[])},4e3)}},{key:"close",value:function(){var e=this;if(this.elem instanceof jQuery==!1)throw new Error("notification has not been rendered yet");this.elem.addClass("close"),setTimeout(function(){e.elem.remove(),e.elem=null,e.parent=null,e.expired=!0},300)}}]),a}(s),b=".notif-bucket",k=[],_=function(){function e(){t(this,e)}return n(e,null,[{key:"getElem",value:function(){return jQuery(b)}},{key:"send",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e.getElem(),i=new w(o,t,n,r);return k.push(i),i.on("close",function(){var e=k.indexOf(i);k.splice(e,1)}),i}},{key:"flush",value:function(){k.forEach(function(e){e.close()})}}]),e}(),E=function(){function e(){t(this,e)}return n(e,null,[{key:"getTrace",value:function(t,n){var r=function(e){return void n(null,e)},o=function(r){var o=_.send("fatal","Network error getting trace",{large:!0,details:"Trying again in a moment will likely fix this issue.",actions:[{name:"Try Again",command:"retry"}]});o.on("retry",function(){e.getTrace(t,n)}),o.on("dismiss",function(){n(r,[])}),o.open()};superagent.post("/trace").send(t.stringify()).end(function(e,t){if(e||t.ok!==!0)o(e);else{var n={};try{n=JSON.parse(t.text),window.parsedTrace=n}catch(e){o()}r(n.trace)}})}}]),e}(),j=function(a){function s(e){t(this,s);var n=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));if(n.cs=new u(e.find(".control-surface")),n.cs.disableCommands(["step-backward","step-forward","jump-start","jump-end"]),n.cs.on("step-backward",function(){n.rendered===!0&&n.index-1>=0&&n.setVisiblePoint(n.index-1)}),n.cs.on("step-forward",function(){n.rendered===!0&&n.index+1<n.trace.length&&n.setVisiblePoint(n.index+1)}),n.cs.on("jump-start",function(){n.rendered===!0&&n.trace.length>1&&n.setVisiblePoint(0)}),n.cs.on("jump-end",function(){n.rendered===!0&&n.trace.length>1&&n.setVisiblePoint(n.trace.length-1)}),n.wrapperElem=e,n.visualizationElem=e.find(".trace-visualization"),n.variablesElem=e.find(".variables-wrapper"),n.visualizationElem.length<1)throw new Error("missing .trace-visualization element");if(n.variablesElem.length<1)throw new Error("missing .variables-wrapper element");return r(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"declareEvent",n).call(n,"set-trace-point"),r(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"declareEvent",n).call(n,"get-advice"),n.rendered=!1,n.trace=[],n.scope={},n.index=0,n.showPendingMessage(),n}return o(s,a),n(s,[{key:"render",value:function(t){var n=this;if(Array.isArray(t)===!1)throw new Error("trace must be an array, received "+("undefined"==typeof t?"undefined":e(t)));var r=[],o="";o+=y(['<div class="scope top-level">','<ol class="execution">']),o+=t.reduceRight(function(t,n,o){var i=h(n.line),a="",s=function(){switch(n.event){case"instruction_limit_reached":return _.send("fatal","VM reached instruction limit",{large:!0,code:n.exception_msg}).open(),{v:t};case"call":var e={};try{e=n.stack_to_render[0].encoded_locals}catch(e){throw new Error("cannot get local variables of point "+o)}var s=Object.keys(e).reduce(function(t,n){return e.hasOwnProperty(n)===!1?t:t.concat(y([y.span("sig-name",n),y.span("sig-syntax",":"),y.span("sig-value",""+e[n])]))},[]).join(y.span("sig-syntax",",")),c=h(n.func_name),l=h(r.pop());if("string"!=typeof l)throw new Error("call with no return value");return a=y(['<li class="point call expanded">',y.input({type:"radio",id:"point-"+o,classes:["point-radio-button"],name:"point",value:o,"data-line":i}),y.label({classes:["func-sig"],for:"point-"+o,children:[y.span("sig-method",""+c),y.span("sig-syntax","("),s,y.span("sig-syntax",")"),y.span("sig-syntax","&xrArr;"),y.span("sig-value field",l)]}),'<div class="scope">','<ol class="execution">']),{v:a+t};case"return":case"step_line":var u="return"===n.event;if(u){var d="void";try{d=n.stack_to_render[0].encoded_locals.__return__.toString()}catch(e){throw new Error('cannot get "__return__" field of point '+o)}r.push(h(d))}return a=y([y.li("point",[y.input({type:"radio",id:"point-"+o,classes:["point-radio-button"],name:"point",value:o,"data-line":i}),y.label({for:"point-"+o})]),u?"</ol>":"",u?"</div>":"",u?"</li>":""]),{v:a+t};default:throw console.error(n),new Error("cannot handle point at index "+o)}}();if("object"===("undefined"==typeof s?"undefined":e(s)))return s.v},""),o+=y(["</div>","</ol>"]),this.visualizationElem.html(o),this.visualizationElem.find('.scope input[type="radio"]').on("click",function(e){var t=jQuery(e.currentTarget).attr("id"),r=parseInt(t.replace("point-",""),10);isNaN(r)&&(r=0),n.setVisiblePoint(r)}),this.trace=t,this.rendered=!0,this.initializeVariableView(),this.setVisiblePoint(0),this.cs.enableCommands(["step-backward","step-forward","jump-start","jump-end"])}},{key:"showPendingMessage",value:function(){var e='<p class="pending">waiting for execution trace&hellip;</p>';this.rendered=!1,this.visualizationElem.html(e),this.variablesElem.html(e)}},{key:"clear",value:function(){this.rendered=!1,this.trace=[],this.scope={},this.index=0,this.cs.disableCommands(["step-backward","step-forward","jump-start","jump-end"]),this.showPendingMessage()}},{key:"setVisiblePoint",value:function(e){if(this.rendered===!0){if(e>=this.trace.length||e<0)throw new Error("index "+e+" is out of range");var t=this.wrapperElem.find(".point-radio-button:eq("+e+")"),n=parseInt(t.attr("data-line"));if(isNaN(n))throw new Error("button at index "+e+' has corrupted "data-line" property');this.index=e,t.prop("checked",!0),this.setVisibleScope(e),r(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"trigger",this).call(this,"set-trace-point",[n])}}},{key:"initializeVariableView",value:function(){var e=this;if(this.rendered===!0){var t="<ol></ol>",n='<button class="action-button success">Get suggestions</button>';this.variablesElem.html(t+n),this.variablesElem.find(".action-button.success").on("click",function(t){var n=e.variablesElem.find("ol li"),r=[];if(n.length>0){var o=n.toArray().filter(function(e){return""!==jQuery(e).find(".edit").val()}).map(function(e){var t=jQuery(e).find(".name").text();return r.push(t),{name:t,oldValue:parseInt(jQuery(e).find(".value").text()),newValue:parseInt(jQuery(e).find(".edit").val())}}),i=JSON.parse(JSON.stringify(e.trace[e.index]));i.stack_to_render[0].ordered_varnames=r,i.stack_to_render[0].encoded_locals=o.reduce(function(e,t){return e[t.name]=t.newValue,e},{}),window.moddedPoint=i}})}}},{key:"setVisibleScope",value:function(e){var t=this;if(this.rendered===!0){if(e>=this.trace.length||e<0)throw new Error("index "+e+" is out of range");var n=this.trace[e],r=n.stack_to_render;if(Array.isArray(r)===!1)throw new Error("malformed scope at index "+e);r.length>0&&!function(){var e=r[0],n=e.encoded_locals||{},o=Object.keys(n).reduce(function(e,t){return n.hasOwnProperty(t)===!1?e:e+y.li([y.span("current",[y.span("name",h(t)),y.span("value field",h(n[t]))])," &xrarr; ",y.input({type:"textbox",classes:["edit"],placeholder:"?"})])},"");t.variablesElem.find("ol").html(o)}()}}}]),s}(s),x="working_program_copy",O={tests:"public class Main {\n    static int SimpleJava() {\n        int a = 2;\n        int b = a + 1;\n        int c = a + b;\n        return c;\n    }\n\n    public static void main(String[] args) {\n        int x = SimpleJava();\n        System.out.println(x);\n    }\n}",hello:'public class HelloWorld {\n    public static void main(String[] args) {\n        System.out.println("Hello world");\n    }\n}',custom:""},C=function(){function e(){t(this,e)}return n(e,null,[{key:"workingCopyExists",value:function(e){if("function"!=typeof e)throw new Error("expected 1st arg. of Storage.workingCopyExists() to be a function");localforage.getItem(x).then(function(t){var n="string"==typeof t;e.apply({},[null,n])}).catch(function(t){e.apply({},[t])})}},{key:"getWorkingCopy",value:function(e){if("function"!=typeof e)throw new Error("expected 1st arg. of Storage.getWorkingCopy() to be a function");localforage.getItem(x).then(function(t){"string"!=typeof t&&(t=""),e.apply({},[null,t])}).catch(function(t){e.apply({},[t])})}},{key:"setWorkingCopy",value:function(e,t){if("string"!=typeof e)throw new Error("expected 1st arg. of Storage.setWorkingCopy() to be a string");if("function"!=typeof t)throw new Error("expected 2nd arg. of Storage.setWorkingCopy() to be a function");localforage.setItem(x,e).then(function(e){t.apply({},[null,e])}).catch(function(e){t.apply({},[e])})}},{key:"setWorkingCopyFromBuiltin",value:function(t,n){if("string"!=typeof t){var r=new Error("expected 1st arg. of Storage.setWorkingCopyFromDefault() to be a string");return void n.apply({},[r])}if(O.hasOwnProperty(t)===!1){var o=new Error("1st arg. of Storage.setWorkingCopyFromDefault() not a valid ID");return void n.apply({},[o])}if("function"!=typeof n){var i=new Error("expected 3rd arg. of Storage.setWorkingCopy() to be a function");return void n.apply({},[i])}e.setWorkingCopy(O[t],n)}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e===!0||window.confirm("Clear local storage?"))&&localforage.clear().then(function(){console.log("Local storage cleared")}).catch(function(e){console.error("Could not clear local storage. Error has been logged"),console.error(e)})}},{key:"workingCopyMatchesBuiltin",value:function(e){for(var t=Object.keys(O),n=0,r=t.length;n<r;n++){var o=t[n];if(O[o]===e)return o}return!1}}]),e}(),P=function(){function e(n,r){t(this,e),this.source=n,this.stdin=r}return n(e,[{key:"stringify",value:function(){return JSON.stringify({source:this.source,input:this.stdin})}}]),e}(),S=function(){function e(){t(this,e),this.edv=new f(jQuery(".mp-editor"),""),this.rtv=new j(jQuery(".mp-runtime")),this.mcs=new u(jQuery(".mp-controls")),this.requestPending=!0,this.requestCancelled=!1,this._init()}return n(e,[{key:"_init",value:function(){var e=this,t=function(){e.mcs.disableCommands(["trace"]),e.mcs.startSpinning("trace"),e.mcs.enableCommands(["halt"]),e.rtv.showPendingMessage(),_.flush();var t=new P(e.edv.getProgram(),""),n=function n(r,o){if(e.requestPending=!1,e.requestCancelled===!0)return void(e.requestCancelled=!1);if(e.mcs.stopSpinning("trace"),e.mcs.enableCommands(["debug"]),null!==r)throw _.send("fatal","Bad trace!").open(),r;if("instruction_limit_reached"===o[0].event){var i=_.send("fatal","Error generating trace",{large:!0,code:o[0].exception_msg,details:"Trying again in a moment will likely fix this issue.",actions:[{name:"Try Again",command:"retry"}]});i.on("retry",function(){e.mcs.startSpinning("trace"),E.getTrace(t,n)}),i.on("dismiss",function(){throw new Error(o[0].exception_msg)}),i.open()}else e.rtv.render(o)};e.requestCancelled=!1,e.requestPending=!0,E.getTrace(t,n)},n=function(){e.mcs.enableCommands(["trace"]),e.mcs.disableCommands(["halt","debug"]),e.rtv.clear(),e.edv.unfreeze(),e.requestCancelled=!0,e.mcs.stopSpinning("trace")},r=function(){var e=jQuery('<div id="debug-popup"></div>');jQuery("body").append(e);var t=jQuery("<textarea>"+JSON.stringify(window.parsedTrace,null,"  ")+"</textarea>"),n=jQuery("<textarea>"+JSON.stringify(window.moddedPoint,null,"  ")+"</textarea>");e.append(t),e.append(n)},o=function(){var t=e.mcs.get("dropdown"),n=a(t,2),r=n[0],o=n[1];return null!==r?void console.error(r):void C.setWorkingCopyFromBuiltin(o,function(t,n){null!==t?console.error(t):(console.log('loaded builtin program "'+o+'"'),e.edv.setProgram(n))})},i=function(t){C.setWorkingCopyFromBuiltin(t,function(n,r){null!==n?console.error(n):(console.log('loaded builtin program "'+t+'"'),e.edv.setProgram(r))})};this.mcs.on("trace",t),this.mcs.on("halt",n),this.mcs.on("debug",r),this.mcs.on("reset",o),this.mcs.on("dropdown",i),this.rtv.on("set-trace-point",function(t){e.edv.freeze(),e.edv.highlightLine(t)}),this.rtv.on("get-advice",function(){t()}),C.workingCopyExists(function(t,n){return null!==t?void console.error(t):void(n?C.getWorkingCopy(function(t,n){if(null!==t)console.error(t);else{console.log("loaded working copy from local storage");var r=C.workingCopyMatchesBuiltin(n);if("string"==typeof r)try{e.mcs.set("dropdown",r)}catch(e){console.error(e)}else try{e.mcs.set("dropdown","custom")}catch(e){console.error(e)}e.edv.setProgram(n,!0)}}):C.setWorkingCopyFromBuiltin("tests",function(t,n){if(null!==t)console.error(t);else{console.log("loaded default program as working copy");try{e.mcs.set("dropdown","tests")}catch(e){console.error(e)}e.edv.setProgram(n,!0)}}))}),window.onbeforeunload=function(){C.setWorkingCopy(e.edv.getProgram(),function(e,t){null!==e?console.error(e):console.log("saved working copy to local storage")})}}}]),e}(),Q=new S;window.app=Q}();
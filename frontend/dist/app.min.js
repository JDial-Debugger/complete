!function(){"use strict";function e(e){return JSON.stringify(e,null,"  ")}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};a?a=a.next=s:(i=a=s,r(e,t))})}function r(n,i){try{var a=t[n](i),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(){n(this,e),this.events={}}return r(e,[{key:"declareEvent",value:function(e){this.events.hasOwnProperty(e)!==!1&&Array.isArray(this.events[e])!==!1||(this.events[e]=[])}},{key:"on",value:function(e,t){if("function"!=typeof t)throw new Error('expected 2nd arg. to be of type "function"');if(this.events.hasOwnProperty(e)===!1)throw new Error('"'+e+'" is not a recognized event');this.events[e].push(t)}},{key:"off",value:function(e,t){if("function"!=typeof t)throw new Error('expected 2nd arg. to be of type "function"');if(this.events[e].hasOwnProperty(e)===!1)throw new Error('"'+e+'" is not a recognized event');if(this.events[e].includes(t)===!1)throw new Error("event listener has not been attached yet");var n=this.events[e].indexOf(t);this.events[e].splice(n,1)}},{key:"trigger",value:function(e,t){if(this.events.hasOwnProperty(e)===!1&&Array.isArray(this.events[e])===!1)throw new Error('"'+e+'" is not a recognized event');this.events[e].forEach(function(e){e.apply({},t)})}}]),e}(),c="show-spinner",u="icon-spinning",d=function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(e instanceof jQuery==!1||jQuery(e).hasClass("control-surface")===!1)throw new Error('expected arg. to be a jQuery object with class "control-surface"');var i=jQuery(e).find(".mp-control-button");return r.commands=jQuery(i).toArray().reduce(function(e,n){var i=jQuery(n).attr("data-command");return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"declareEvent",r).call(r,i),e[i]=n,jQuery(n).on("click",function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"trigger",r).call(r,i,[])}),e},{}),0!==jQuery(e).find(".spinner-wrapper").length?(r.spinner=jQuery(e).find(".spinner-wrapper"),r.spinnerOff()):r.spinner=null,0!==jQuery(e).find(".dropdown").length?r.dropdown=jQuery(e).find(".dropdown"):r.dropdown=null,r}return i(t,e),r(t,[{key:"on",value:function(e,n){"dropdown"===e&&null!==this.dropdown?jQuery(this.dropdown).on("change",function(e){n.apply({},[jQuery(e.currentTarget).val()])}):o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"get",value:function(e){if("dropdown"===e){if(null!==this.dropdown){var t=jQuery(this.dropdown).val();return[null,t]}var n=new Error('control surface lacks <select> to support "'+e+'"');return[n,""]}var r=new Error('command "'+e+'" is not available from this control surface');return[r,""]}},{key:"set",value:function(e,t){switch(e){case"dropdown":if(null===this.dropdown)throw new Error('control surface lacks <select> to support "'+e+'"');if(!(jQuery(this.dropdown).find('option[value="'+t+'"]').length>0))throw new Error("<select> has no option with the value "+t);jQuery(this.dropdown).val(t);break;default:throw new Error('command "'+e+'" is not available from this control surface')}}},{key:"startSpinning",value:function(e){if(Object.keys(this.commands).includes(e)===!1)throw new Error('command "'+e+'" is not availalbe from this control surface');jQuery(this.commands[e]).addClass(u)}},{key:"stopSpinning",value:function(e){if(Object.keys(this.commands).includes(e)===!1)throw new Error('command "'+e+'" is not availalbe from this control surface');jQuery(this.commands[e]).removeClass(u)}},{key:"disableCommands",value:function(e){var t=this;if(Array.isArray(e)===!1)throw new Error("1st argument of ControlSurface.disableActions must be an array");e.forEach(function(e){if(Object.keys(t.commands).includes(e)===!1)throw new Error('command "'+e+'" is not available from this control surface');jQuery(t.commands[e]).attr("disabled",!0)})}},{key:"enableCommands",value:function(e){var t=this;if(Array.isArray(e)===!1)throw new Error("1st argument of ControlSurface.enableCommands must be an array");e.forEach(function(e){if(Object.keys(t.commands).includes(e)===!1)throw new Error('command "'+e+'" is not available from this control surface');jQuery(t.commands[e]).attr("disabled",!1)})}},{key:"spinnerOn",value:function(){null!==this.spinner&&jQuery(this.spinner).addClass(c)}},{key:"spinnerOff",value:function(){null!==this.spinner&&jQuery(this.spinner).removeClass(c)}}]),t}(l),f={"&":"&amp;","<":"&lt;",">":"&gt"},p=function(e){return"string"!=typeof e&&(e=""+e),e.replace(/[&<>]/g,function(e){return f[e]||e})},h=function(e){return e.reduce(function(e,t){return e+t},"")},g=[["button",!1],["code",!1],["div",!1],["input",!0],["label",!1],["li",!1],["p",!1],["span",!1]],y=["children","classes","for","id","name","placeholder","title","type","value"];g.forEach(function(e){var n=e[0],r=e[1];h[n]=function(e,o){if("string"==typeof e){if("string"==typeof o){if(r)throw new Error("self closing tags like "+n+" can not have children");return"<"+n+' class="'+e+'">'+o+"</"+n+">"}if("undefined"==typeof o)return r?"<"+n+">":"<"+n+' class="'+e+'"></'+n+">";if(Array.isArray(o))return"<"+n+' class="'+e+'">'+o.join("")+"</"+n+">";throw console.log(o),new Error("un-recognized type of second argument")}if(Array.isArray(e)){if(r)throw new Error("self closing tags like "+n+" can not have children");return"<"+n+">"+e.join("")+"</"+n+">"}if("object"===("undefined"==typeof e?"undefined":t(e))){var i=Object.keys(e).reduce(function(t,n){if(e.hasOwnProperty(n)===!1)return t;if("children"===n)return t;if(/^data-[a-zA-Z0-9\-_]*$/.test(n))return t+(" "+n+'="'+e[n]+'"');if(y.includes(n))return"classes"===n?Array.isArray(e.classes)?t+(' class="'+e.classes.join(" ")+'"'):t+(' class="'+e.classes+'"'):t+(" "+n+'="'+e[n]+'"');throw new Error('un-recognized attribute named: "'+n+'"')},"");if(r&&Array.isArray(e.children))throw new Error("self closing tags like "+n+" can not have children");var a="";if("undefined"==typeof e.children)a="";else if("string"==typeof e.children)a=e.children;else{if(!(e.children instanceof Array))throw console.error(e),new Error("un-recognized type of children field");a=e.children.map(function(e){return e.toString()}).join("")}return r?"<"+n+i+">":"<"+n+i+">"+a+"</"+n+">"}throw new Error("could not parse htmlBuilder inputs")}});var v=["fatal","alert","info","success"],m=function(e){function t(e,r,i,s){n(this,t);var l=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"declareEvent",l).call(l,"dismiss"),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"declareEvent",l).call(l,"close"),v.includes(r)===!1)throw new Error('"'+r+'" is an invlaid notification type');return l.parent=e,l.type=r,l.title=p(i),l.large=s.large===!0,"string"==typeof s.code?(l.hasCode=!0,l.code=p(s.code).replace("\n","<br>")):(l.hasCode=!1,l.code=""),"string"==typeof s.details?(l.hasDetails=!0,l.details=p(s.details)):l.hasDetails=!1,l.actions=[],Array.isArray(s.actions)&&(l.actions=s.actions.reduce(function(e,n){return n.hasOwnProperty("name")&&n.hasOwnProperty("command")&&"string"==typeof n.name&&"string"==typeof n.command&&(e=e.concat({name:n.name,command:n.command}),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"declareEvent",l).call(l,n.command)),e},[])),l.expired=!1,l}return i(t,e),r(t,[{key:"on",value:function(e,n){if(this.expired===!0)throw new Error("notification has expired");o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"trigger",value:function(e,n){if(this.expired===!0)throw new Error("notification has expired");o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"trigger",this).call(this,e,n)}},{key:"open",value:function(){var e=this;if(this.expired===!0)throw new Error("notification has expired");if(this.parent instanceof jQuery==!1)throw new Error("notification has not parent element");var t="";t+=h.div({classes:["notif",this.type,this.large?"large":""],children:[h.div("tag"),this.large?h.button({classes:"dismiss",title:"Dismiss",children:"&times;"}):"",h.div({classes:"content",children:[h.p("title",this.title),this.hasCode?h.code({children:this.code}):"",this.hasDetails?h.p("details",this.details):"",this.actions.length>0?this.actions.reduce(function(e,t,n){return e+h.button({classes:"action","data-command":t.command,children:t.name})},""):""]})]});var n=jQuery(t);n.find("button.dismiss").on("click",function(){try{e.trigger("dismiss",[])}finally{e.close()}}),n.find("button[data-command]").on("click",function(t){var n=jQuery(t.currentTarget),r=n.attr("data-command");if("string"==typeof r)try{e.trigger(r,[])}finally{e.close()}}),this.elem=n,jQuery(this.parent).append(n),this.large===!1&&setTimeout(function(){e.close()},4e3)}},{key:"close",value:function(){var e=this;return this.elem instanceof jQuery!=!1&&(this.elem.addClass("close"),void setTimeout(function(){null!==e.elem&&e.elem.remove(),e.elem=null,e.parent=null,e.expired=!0},300))}}]),t}(l),w=".notif-bucket",b=[],k=function(){function e(){n(this,e)}return r(e,null,[{key:"getElem",value:function(){return jQuery(w)}},{key:"send",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e.getElem(),i=new m(o,t,n,r);return b.push(i),i.on("close",function(){var e=b.indexOf(i);b.splice(e,1)}),i}},{key:"flush",value:function(){b.forEach(function(e){e.close()})}}]),e}(),_="active-line",E=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"declareEvent",i).call(i,"apply-suggestion"),e instanceof jQuery==!1)throw new Error("expected argument to new EditorView() to be a jQuery object");return i.wrapperElem=e,i.editor=CodeMirror(i.wrapperElem[0],{mode:"text/x-java",theme:"neat",value:r,lineNumbers:!0,indentUnit:4,smartIndent:!1,tabSize:4,indentWithTabs:!0,electricChars:!1}),i.highlightedLine=-1,i.frozen=!1,i}return i(t,e),r(t,[{key:"getProgram",value:function(){return this.editor.getValue()}},{key:"setProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof e)throw new Error("expected 1st arg. of EditorView.setProgram() to be a string");this.editor.setValue(e),t===!0&&this.editor.clearHistory()}},{key:"freeze",value:function(){this.frozen=!0,this.editor.setOption("readOnly","nocursor")}},{key:"unfreeze",value:function(){this.frozen=!1,this.editor.setOption("readOnly",!1),this.clearHighlightedLine(),this.editor.focus()}},{key:"highlightLine",value:function(e){if(this.frozen===!1)throw new Error("cannot highlight line until editor is frozen");e--,this.highlightedLine>=0&&this.clearHighlightedLine();var t=20;this.editor.addLineClass(e,"gutter",_),this.editor.addLineClass(e,"background",_),this.editor.scrollIntoView({line:e,ch:0},t),this.highlightedLine=e}},{key:"clearHighlightedLine",value:function(){this.highlightedLine!==-1&&(this.editor.removeLineClass(this.highlightedLine,"gutter",_),this.editor.removeLineClass(this.highlightedLine,"background",_),this.highlightedLine=-1)}},{key:"makeSuggestion",value:function(e){var t=this,n=e.match(/\{([^\n]*)\}/);if(null===n||n[1]&&0===n[1].length)throw console.error("RAW SUGGESTION: "+e),new Error("no suggestion");var r=n[1];r.split(",").filter(function(e,t){return 0===t}).forEach(function(e){var n=e.split("=");if(2!==n.length)throw new Error("no pairs: "+r);var o=parseInt(n[0],10),i=parseInt(n[1],10);if(isNaN(o))throw new Error("line is NaN: "+r);if(isNaN(i))throw new Error("value is NaN: "+r);var a=k.send("success","Possible change",{code:"add "+i+" on line #"+o+"?",large:!0,actions:[{name:"Change",command:"apply-suggestion"},{name:"Try again",command:"different-suggestion"}]});a.on("apply-suggestion",function(){var e=t.editor.getLine(o-1),n=e.replace(/\b\d+\b/,i.toString());t.editor.replaceRange(n,{line:o-1,ch:0},{line:o-1,ch:e.length}),t.trigger("apply-suggestion",[])}),a.on("different-suggestion",function(){k.send("info","Make different suggestion").open()}),a.on("dismiss",function(){k.send("info","Suggestion ignored").open()}),a.open()})}}]),t}(l),j=function(){function e(){n(this,e)}return r(e,null,[{key:"getTrace",value:function(t,n){var r=function(e){return void n(null,e)},o=function(r){var o=k.send("fatal","Network error getting trace",{large:!0,details:"Trying again in a moment will likely fix this issue.",actions:[{name:"Try Again",command:"retry"}]});o.on("retry",function(){e.getTrace(t,n)}),o.on("dismiss",function(){n(r,[])}),o.open()};superagent.post("/trace").send(t.stringify()).end(function(e,t){if(e||t.ok!==!0)o(e);else{var n={};try{n=JSON.parse(t.text)}catch(e){o()}r(n)}})}},{key:"getSuggestion",value:function(t,n){var r=function(e){return void n(null,e)},o=function(r){var o=k.send("fatal","Network error getting trace",{large:!0,details:"Trying again in a moment will likely fix this issue.",actions:[{name:"Try Again",command:"retry"}]});o.on("retry",function(){e.getSuggestion(t,n)}),o.on("dismiss",function(){n(r,[])}),o.open()};superagent.post("/suggest").send(t.stringify()).end(function(e,t){e||t.ok!==!0?o(e):r(t.text)})}}]),e}(),x=jQuery("#devtools-view"),O={fullTrace:x.find("#devtools-trace-json"),point:x.find("#devtools-mod-trace-json"),index:x.find("#devtools-mod-trace-index")};x.find(".close-devtools").on("click",function(){C.hidePanel()});var C=function(){function t(){n(this,t)}return r(t,null,[{key:"initializeClipboard",value:function(){new Clipboard("button[data-clipboard-target]")}},{key:"setWholeTrace",value:function(t){jQuery(O.fullTrace).val(e(t))}},{key:"setModifiedTracePoint",value:function(t,n){O.point.val(e(t)),O.index.val(n)}},{key:"clearTraceData",value:function(){O.fullTrace.val(""),O.point.val(""),O.index.val("")}},{key:"showPanel",value:function(){x.addClass("visible")}},{key:"hidePanel",value:function(){x.removeClass("visible")}}]),t}(),P=function(){function e(t,r,o){if(n(this,e),"string"!=typeof t)throw new Error("expected `trace` to have type String");if("string"!=typeof r)throw new Error("expected `point` to have type String");if("number"!=typeof o)throw new Error("expected `pointIndex` to have type Number");this.trace=t,this.point=r,this.pointIndex=o}return r(e,[{key:"stringify",value:function(){return JSON.stringify({full_trace:this.trace,modified_point:this.point,modified_point_index:this.pointIndex})}}]),e}(),S=function(e){function s(e){n(this,s);var t=a(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));if(t.cs=new d(e.find(".control-surface")),t.cs.disableCommands(["step-backward","step-forward","jump-start","jump-end"]),t.cs.on("step-backward",function(){t.rendered===!0&&t.index-1>=0&&t.setVisiblePoint(t.index-1)}),t.cs.on("step-forward",function(){t.rendered===!0&&t.index+1<t.trace.length&&t.setVisiblePoint(t.index+1)}),t.cs.on("jump-start",function(){t.rendered===!0&&t.trace.length>1&&t.setVisiblePoint(0)}),t.cs.on("jump-end",function(){t.rendered===!0&&t.trace.length>1&&t.setVisiblePoint(t.trace.length-1)}),t.wrapperElem=e,t.visualizationElem=e.find(".trace-visualization"),t.variablesElem=e.find(".variables-wrapper"),t.visualizationElem.length<1)throw new Error("missing .trace-visualization element");if(t.variablesElem.length<1)throw new Error("missing .variables-wrapper element");return o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"declareEvent",t).call(t,"set-trace-point"),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"declareEvent",t).call(t,"get-suggestion"),t.rendered=!1,t.trace=[],t.scope={},t.index=0,t.showPendingMessage(),t}return i(s,e),r(s,[{key:"render",value:function(e){var n=this,r=e.trace;if(C.setWholeTrace(r),Array.isArray(r)===!1)throw new Error("trace must be an array, received "+("undefined"==typeof r?"undefined":t(r)));var o=[],i="";i+=h(['<div class="scope top-level">','<ol class="execution">']),i+=r.reduceRight(function(e,n,r){var i=p(n.line),a="",s=function(){switch(n.event){case"uncaught_exception":throw k.send("fatal","Uncaught exception on line "+n.line,{large:!0,code:n.exception_msg}).open(),new Error(n);case"instruction_limit_reached":return k.send("fatal","VM reached instruction limit",{large:!0,code:n.exception_msg}).open(),{v:e};case"call":var t={};try{t=n.stack_to_render[0].encoded_locals}catch(e){throw new Error("cannot get local variables of point "+r)}var s=Object.keys(t).reduce(function(e,n){return t.hasOwnProperty(n)===!1?e:e.concat(h([h.span("sig-name",n),h.span("sig-syntax",":"),h.span("sig-value",""+t[n])]))},[]).join(h.span("sig-syntax",",")),l=p(n.func_name),c=o.pop();if("undefined"==typeof c.value)throw new Error("call with no return value");return a=h(['<li class="point call expanded">',h.input({type:"radio",id:"point-"+r,classes:["point-radio-button"],name:"point",value:r,"data-line":i}),h.label({classes:["func-sig"],for:"point-"+r,children:[h.span("sig-method",""+l),h.span("sig-syntax","("),s,h.span("sig-syntax",")"),h.span("sig-syntax","&xrArr;"),h.span({classes:["sig-value","field","sig-return-value"],children:p(c.value.toString()),"data-point":p(c.index.toString())})]}),'<div class="scope">','<ol class="execution">']),{v:a+e};case"return":case"step_line":var u="return"===n.event;if(u){var d="void";try{d=n.stack_to_render[0].encoded_locals.__return__}catch(e){throw k.send("fatal","Malformed execution trace",{large:!0,code:"trace point "+r+' has type "return" but no `__return__` field',details:'Try running "Trace" again'}).open(),new Error('cannot get "__return__" field of point '+r)}o.push({value:d,line:n.line||-1,index:r})}return a=h([h.li("point",[h.input({type:"radio",id:"point-"+r,classes:["point-radio-button"],name:"point",value:r,"data-line":i}),h.label({for:"point-"+r})]),u?"</ol>":"",u?"</div>":"",u?"</li>":""]),{v:a+e};default:throw console.error(n),new Error("cannot handle point at index "+r)}}();if("object"===("undefined"==typeof s?"undefined":t(s)))return s.v},""),i+=h(["</div>","</ol>"]),this.visualizationElem.html(i),this.visualizationElem.find('.scope input[type="radio"]').on("click",function(e){var t=jQuery(e.currentTarget).attr("id"),r=parseInt(t.replace("point-",""),10);isNaN(r)&&(r=0),n.setVisiblePoint(r)}),this.visualizationElem.find(".scope .sig-return-value").on("click",function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(jQuery(e.currentTarget).attr("data-point"),10);if(isNaN(t))throw k.send("fatal","Unknown return point").open(),new Error("unknown return point");return n.setVisiblePoint(t,"__return__"),!1}),this.whole=e,this.trace=r,this.rendered=!0,this.initializeVariableView(),this.setVisiblePoint(0),this.cs.enableCommands(["step-backward","step-forward","jump-start","jump-end"])}},{key:"showPendingMessage",value:function(){var e='<p class="pending">waiting for execution trace&hellip;</p>';this.rendered=!1,this.visualizationElem.html(e),this.variablesElem.html(e)}},{key:"clear",value:function(){this.rendered=!1,this.trace=[],this.scope={},this.index=0,this.cs.disableCommands(["step-backward","step-forward","jump-start","jump-end"]),this.showPendingMessage()}},{key:"setVisiblePoint",value:function(e,t){if(this.rendered===!0){if(e>=this.trace.length||e<0)throw new Error("index "+e+" is out of range");var n=this.wrapperElem.find(".point-radio-button:eq("+e+")"),r=parseInt(n.attr("data-line"));if(isNaN(r))throw new Error("button at index "+e+' has corrupted "data-line" property');this.index=e,n.prop("checked",!0),this.setVisibleScope(e),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"trigger",this).call(this,"set-trace-point",[r]),"string"==typeof t&&this.variablesElem.find('ol li[data-variable="'+t+'"]').addClass("edit-alert").find(".edit").focus()}}},{key:"initializeVariableView",value:function(){var e=this;if(this.rendered===!0){var t="<ol></ol>",n='<button class="action-button success">Get suggestions</button>';this.variablesElem.html(t+n),this.variablesElem.find(".action-button.success").on("click",function(t){var n=e.variablesElem.find("ol li");if(n.length>0){var r=!1,o=n.toArray().filter(function(e){return""!==jQuery(e).find(".edit").val()}).map(function(e){var t=jQuery(e).find(".name").text(),n=parseInt(jQuery(e).find(".value").text()),o=parseInt(jQuery(e).find(".edit").val());return isNaN(n)&&(r=!0),isNaN(o)&&(r=!0),{varname:t,oldValue:n,newValue:o}});r===!1&&e.getSuggestions(o)}})}}},{key:"getSuggestions",value:function(e){if(this.rendered===!0){if(this.index>=this.trace.length||this.index<0)throw new Error("index "+this.index+" is out of range");var t=JSON.parse(JSON.stringify(this.trace[this.index]));t.stack_to_render[0].encoded_locals=e.reduce(function(e,t){return e[t.varname]=t.newValue,e},{}),t.stack_to_render[0].ordered_varnames=e.map(function(e){return e.varname});var n=JSON.stringify(this.whole),r=JSON.stringify(t),o=this.index;C.setModifiedTracePoint(t,o),this.trigger("get-suggestion",[new P(n,r,o)])}}},{key:"setVisibleScope",value:function(e){var t=this;if(this.rendered===!0){if(e>=this.trace.length||e<0)throw new Error("index "+e+" is out of range");var n=this.trace[e],r=n.stack_to_render;if(Array.isArray(r)===!1)throw new Error("malformed scope at index "+e);r.length>0&&!function(){var e=r[0],n=e.encoded_locals||{},o=Object.keys(n).reduce(function(e,t){return n.hasOwnProperty(t)===!1?e:e+h.li({"data-variable":p(t),children:[h.span("current",[h.span("name",p(t)),h.span("value field",p(n[t]))])," &xrarr; ",h.input({type:"textbox",classes:["edit"],placeholder:"?"})]})},"");t.variablesElem.find("ol").html(o)}()}}}]),s}(l),Q="working_program_copy",A={tests:"public class Main {\n    static int SimpleJava() {\n        int a = 2;\n        int b = a + 1;\n        int c = a + b;\n        return c;\n    }\n\n    public static void main(String[] args) {\n        int x = SimpleJava();\n        System.out.println(x);\n    }\n}",hello:'public class HelloWorld {\n    public static void main(String[] args) {\n        System.out.println("Hello world");\n    }\n}',custom:""},T=function(){function e(){n(this,e)}return r(e,null,[{key:"workingCopyExists",value:function(e){if("function"!=typeof e)throw new Error("expected 1st arg. of Storage.workingCopyExists() to be a function");localforage.getItem(Q).then(function(t){var n="string"==typeof t;e.apply({},[null,n])}).catch(function(t){e.apply({},[t])})}},{key:"getWorkingCopy",value:function(e){if("function"!=typeof e)throw new Error("expected 1st arg. of Storage.getWorkingCopy() to be a function");localforage.getItem(Q).then(function(t){"string"!=typeof t&&(t=""),e.apply({},[null,t])}).catch(function(t){e.apply({},[t])})}},{key:"setWorkingCopy",value:function(e,t){if("string"!=typeof e)throw new Error("expected 1st arg. of Storage.setWorkingCopy() to be a string");if("function"!=typeof t)throw new Error("expected 2nd arg. of Storage.setWorkingCopy() to be a function");localforage.setItem(Q,e).then(function(e){t.apply({},[null,e])}).catch(function(e){t.apply({},[e])})}},{key:"setWorkingCopyFromBuiltin",value:function(t,n){if("string"!=typeof t){var r=new Error("expected 1st arg. of Storage.setWorkingCopyFromDefault() to be a string");return void n.apply({},[r])}if(A.hasOwnProperty(t)===!1){var o=new Error("1st arg. of Storage.setWorkingCopyFromDefault() not a valid ID");return void n.apply({},[o])}if("function"!=typeof n){var i=new Error("expected 3rd arg. of Storage.setWorkingCopy() to be a function");return void n.apply({},[i])}e.setWorkingCopy(A[t],n)}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e===!0||window.confirm("Clear local storage?"))&&localforage.clear().then(function(){console.log("Local storage cleared")}).catch(function(e){console.error("Could not clear local storage. Error has been logged"),console.error(e)})}},{key:"workingCopyMatchesBuiltin",value:function(e){for(var t=Object.keys(A),n=0,r=t.length;n<r;n++){var o=t[n];if(A[o]===e)return o}return!1}}]),e}(),N=function(){function e(t,r){n(this,e),this.source=t,this.stdin=r}return r(e,[{key:"stringify",value:function(){return JSON.stringify({source:this.source,input:this.stdin})}}]),e}(),z=function(){function e(){n(this,e),this.edv=new E(jQuery(".mp-editor"),""),this.rtv=new S(jQuery(".mp-runtime")),this.mcs=new d(jQuery(".mp-controls")),this.requestPending=!0,this.requestCancelled=!1,this._init(),C.initializeClipboard()}return r(e,[{key:"_init",value:function(){var e=this,t=function(){e.mcs.disableCommands(["trace"]),e.mcs.startSpinning("trace"),e.mcs.enableCommands(["halt"]),e.rtv.showPendingMessage(),k.flush();var t=new N(e.edv.getProgram(),""),n=function n(r,o){if(e.requestPending=!1,e.requestCancelled===!0)return void(e.requestCancelled=!1);e.mcs.stopSpinning("trace");var i=o.trace;if(null!==r)throw k.send("fatal","Bad trace!").open(),r;if("instruction_limit_reached"===i[i.length-1].event){var a=k.send("fatal","Error generating trace",{large:!0,code:i[0].exception_msg,details:"Trying again in a moment will likely fix this issue.",actions:[{name:"Try Again",command:"retry"}]});a.on("retry",function(){e.mcs.startSpinning("trace"),j.getTrace(t,n)}),a.on("dismiss",function(){throw new Error(i[0].exception_msg)}),a.open()}else e.rtv.render(o)};e.requestCancelled=!1,e.requestPending=!0,j.getTrace(t,n)},n=function(t){e.mcs.disableCommands(["trace"]),e.mcs.startSpinning("trace"),e.mcs.enableCommands(["halt"]),k.flush();var n=function(t,n){if(e.requestPending=!1,e.requestCancelled===!0)return void(e.requestCancelled=!1);if(e.mcs.stopSpinning("trace"),null!==t)k.send("fatal","Error getting suggestion").open();else try{e.edv.makeSuggestion(n)}catch(e){"no suggestion"===e.message?k.send("alert","Could not make suggestion").open():k.send("fatal","Unknown error analyzing suggestion response",{code:e.message,large:!0}).open()}};e.requestCancelled=!1,e.requestPending=!0,j.getSuggestion(t,n)},r=function(){e.mcs.enableCommands(["trace"]),e.mcs.disableCommands(["halt"]),e.rtv.clear(),e.edv.unfreeze(),e.requestCancelled=!0,e.mcs.stopSpinning("trace"),C.clearTraceData()},o=function(){C.showPanel()},i=function(){var t=e.mcs.get("dropdown"),n=s(t,2),r=n[0],o=n[1];return null!==r?void console.error(r):void T.setWorkingCopyFromBuiltin(o,function(t,n){null!==t?console.error(t):(console.log('loaded builtin program "'+o+'"'),e.edv.setProgram(n))})},a=function(t){T.setWorkingCopyFromBuiltin(t,function(n,r){null!==n?console.error(n):(console.log('loaded builtin program "'+t+'"'),e.edv.setProgram(r))})};this.mcs.on("trace",t),this.mcs.on("halt",r),this.mcs.on("debug",o),this.mcs.on("reset",i),this.mcs.on("dropdown",a),this.edv.on("apply-suggestion",t),this.rtv.on("set-trace-point",function(t){e.edv.freeze(),e.edv.highlightLine(t)}),this.rtv.on("get-suggestion",n),T.workingCopyExists(function(t,n){return null!==t?void console.error(t):void(n?T.getWorkingCopy(function(t,n){if(null!==t)console.error(t);else{console.log("loaded working copy from local storage");var r=T.workingCopyMatchesBuiltin(n);if("string"==typeof r)try{e.mcs.set("dropdown",r)}catch(e){console.error(e)}else try{e.mcs.set("dropdown","custom")}catch(e){console.error(e)}e.edv.setProgram(n,!0)}}):T.setWorkingCopyFromBuiltin("tests",function(t,n){if(null!==t)console.error(t);else{console.log("loaded default program as working copy");try{e.mcs.set("dropdown","tests")}catch(e){console.error(e)}e.edv.setProgram(n,!0)}}))}),window.onbeforeunload=function(){T.setWorkingCopy(e.edv.getProgram(),function(e,t){null!==e?console.error(e):console.log("saved working copy to local storage")})}}}]),e}(),V=new z;window.app=V}();